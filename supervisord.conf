; supervisord.conf

[supervisord]
nodaemon=true ; Dockerで必須。フォアグラウンドで起動。
minfds=1024
minprocs=200

; --- 1. Webサーバー (Gunicorn/Flask) ---
[program:web]
command=/usr/local/bin/gunicorn -w 4 -b 0.0.0.0:8080 app:app
directory=/app
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

; --- 2. RQワーカー ---
; Redisからタスクを取得し、worker.pyのタスクを実行する
[program:worker]
command=/usr/local/bin/rq worker
directory=/app
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

; RQワーカーを複数起動する場合は、numprocs=N を設定
; [program:worker:x]
; process_name=%(program_name)s_%(process_num)02d
; numprocs=2
